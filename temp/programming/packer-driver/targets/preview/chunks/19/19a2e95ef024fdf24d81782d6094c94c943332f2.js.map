{"version":3,"sources":["file:///C:/D-Disk/cocos%20project/ScrollTest/assets/scripts/ScrollViewRendererCtrl.ts"],"names":["_decorator","Component","ScrollView","Vec3","Rect","UITransform","UIOpacity","ccclass","property","ScrollViewRendererCtrl","start","update","deltaTime","onEnable","node","on","_onScrollingDrawCallOpt","onDisable","off","scrollView","content","children","length","calculate","uiTransform","getComponent","parentTransform","parent","scrollViewPosition","position","svLeftBottomPoint","convertToWorldSpaceAR","x","anchorX","width","y","anchorY","height","z","svBBoxRect","console","log","forEach","childNode","childTransform","childBoundingBox","getBoundingBoxToWorld","childOpacity","addComponent","intersects","opacity"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, ScrollView,Vec2,Vec3, Rect, UITransform, UIOpacity } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('ScrollViewRendererCtrl')\nexport class ScrollViewRendererCtrl extends Component {\n    \n    @property(ScrollView)\n    scrollView:ScrollView;\n\n    start() {\n\n    }\n\n    update(deltaTime: number) {\n        \n    }\n\n    protected onEnable(): void {\n        this.node.on(\"scrolling\", this._onScrollingDrawCallOpt, this);\n    }\n\n    protected onDisable(): void {\n        this.node.off(\"scrolling\", this._onScrollingDrawCallOpt, this);\n    }\n\n    private _onScrollingDrawCallOpt() {\n        if (this.scrollView.content!.children.length === 0) {\n            return;\n        }\n        // 上文提及到的碰撞检测代码\n        // ...\n    }\n\n    \n    public calculate(){\n        // 获取 ScrollView Node 的 UITransform 组件\nlet uiTransform = this.scrollView.node.getComponent(UITransform);\n\nif (uiTransform) {\n  // 获取 ScrollView Node 的父节点的 UITransform 组件\n  let parentTransform = this.scrollView.node.parent!.getComponent(UITransform);\n  \n  if (parentTransform) {\n    // 将 Vec3 的位置转换为 Vec2\n    let scrollViewPosition = this.scrollView.node.position;\n    let svLeftBottomPoint = parentTransform.convertToWorldSpaceAR(\n      new Vec3(\n        scrollViewPosition.x - uiTransform.anchorX * uiTransform.width,\n        scrollViewPosition.y - uiTransform.anchorY * uiTransform.height,\n        scrollViewPosition.z\n      )\n    );\n\n     // 求出 ScrollView 可视区域在世界坐标系中的矩形（碰撞盒）\n     let svBBoxRect: Rect = new Rect(\n        svLeftBottomPoint.x,\n        svLeftBottomPoint.y,\n        uiTransform.width,\n        uiTransform.height\n      );\n  \n      console.log('ScrollView Bounding Box:', svBBoxRect);\n  \n      // 遍历 ScrollView Content 内容节点的子节点\n      this.scrollView.content!.children.forEach((childNode: Node) => {\n        // 获取子节点的 UITransform 组件\n        let childTransform = childNode.getComponent(UITransform);\n  \n        if (childTransform) {\n          // 获取子节点的包围盒\n          let childBoundingBox = childTransform.getBoundingBoxToWorld();\n          // 获取子节点的 UIOpacity 组件\n          let childOpacity = childNode.getComponent(UIOpacity);\n  \n          if (!childOpacity) {\n            // 如果子节点没有 UIOpacity 组件，则添加一个\n            childOpacity = childNode.addComponent(UIOpacity);\n          }\n  \n          // 对每个子节点的包围盒做和 ScrollView 可视区域包围盒做碰撞判断\n          // 如果相交了，那么就显示，否则就隐藏\n          if (childBoundingBox.intersects(svBBoxRect)) {\n            if (childOpacity.opacity !== 255) {\n              childOpacity.opacity = 255;\n              // childNode.emit(\"on_enter_scroll_view\");\n            }\n          } else {\n            if (childOpacity.opacity !== 0) {\n              childOpacity.opacity = 0;\n              // childNode.emit(\"on_exit_scroll_view\");\n            }\n          }\n        }\n      });\n    }\n\n    \n  }\n}}"]}